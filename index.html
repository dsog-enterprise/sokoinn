<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.5, maximum-scale=1.0, user-scalable=no">
    <title>SokoInn Marketplace | Trusted Sellers, Quality Products</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#800000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    
    <!-- Performance optimizations -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://images.unsplash.com">
    
    <style>
        /* ==================== CSS VARIABLES ==================== */
        :root {
            --maroon: #800000;
            --black: #000000;
            --white: #FFFFFF;
            --light-maroon: #a62a2a;
            --dark-maroon: #660000;
            --gray-100: #f5f5f5;
            --gray-200: #e5e5e5;
            --gray-300: #d4d4d4;
            --gray-400: #a3a3a3;
            --gray-500: #737373;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --transition: all 0.2s ease;
        }
        
        /* ==================== RESET & BASE ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.5;
            color: var(--black);
            background: var(--white);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }
        
        img {
            max-width: 100%;
            height: auto;
            display: block;
        }
        
        a {
            color: inherit;
            text-decoration: none;
        }
        
        button {
            font: inherit;
            border: none;
            background: none;
            cursor: pointer;
        }
        
        input, textarea, select {
            font: inherit;
        }
        
        /* ==================== UTILITY CLASSES ==================== */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .text-center { text-align: center; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 1rem; }
        .mb-4 { margin-bottom: 1.5rem; }
        .mb-6 { margin-bottom: 2rem; }
        .mt-4 { margin-top: 1.5rem; }
        .mt-6 { margin-top: 2rem; }
        .hidden { display: none !important; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 1rem; }
        .gap-4 { gap: 1.5rem; }
        .w-full { width: 100%; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .text-maroon { color: var(--maroon); }
        .text-gray-500 { color: var(--gray-500); }
        .text-white { color: var(--white); }
        .bg-maroon { background: var(--maroon); }
        .bg-white { background: var(--white); }
        
        /* ==================== INSTALL BUTTON ==================== */
        .install-button {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 99;
            background: var(--maroon);
            color: white;
            border-radius: var(--radius-md);
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            box-shadow: var(--shadow-md);
            display: none;
            align-items: center;
            gap: 0.5rem;
            animation: slideInRight 0.3s ease;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* ==================== LOADING & SKELETON ==================== */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--gray-300);
            border-top-color: var(--maroon);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .skeleton {
            background: linear-gradient(90deg, var(--gray-100) 25%, var(--gray-200) 50%, var(--gray-100) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-md);
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        /* ==================== HEADER ==================== */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            box-shadow: var(--shadow-sm);
            padding: 1rem 0;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--maroon);
        }
        
        .logo-icon {
            width: 32px;
            height: 32px;
            background: var(--maroon);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            font-weight: 700;
        }
        
        .nav-toggle {
            width: 40px;
            height: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 4px;
            padding: 8px;
        }
        
        .nav-toggle span {
            width: 20px;
            height: 2px;
            background: var(--black);
            transition: var(--transition);
            border-radius: 1px;
        }
        
        .nav-toggle.active span:nth-child(1) {
            transform: rotate(45deg) translate(4px, 4px);
        }
        
        .nav-toggle.active span:nth-child(2) {
            opacity: 0;
        }
        
        .nav-toggle.active span:nth-child(3) {
            transform: rotate(-45deg) translate(4px, -4px);
        }
        
        .mobile-nav {
            position: fixed;
            top: 0;
            right: -100%;
            width: 280px;
            height: 100vh;
            background: var(--white);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: right 0.3s ease;
            padding: 5rem 1.5rem 2rem;
            overflow-y: auto;
        }
        
        .mobile-nav.active {
            right: 0;
        }
        
        .mobile-nav a {
            display: block;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--gray-200);
            font-weight: 500;
        }
        
        .mobile-nav a:last-child {
            border-bottom: none;
        }
        
        .mobile-nav a:hover {
            color: var(--maroon);
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        
        .overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* ==================== IMPROVED HERO SECTION WITH SLIDESHOW ==================== */
        .hero {
            position: relative;
            height: 500px;
            overflow: hidden;
            color: var(--white);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .hero-slideshow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .hero-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        
        .hero-slide.active {
            opacity: 1;
        }
        
        .hero-slide::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7), rgba(128,0,0,0.8));
        }
        
        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            padding: 2rem;
        }
        
        .hero h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            line-height: 1.2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .hero p {
            font-size: 1.125rem;
            opacity: 0.9;
            margin-bottom: 2rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .search-box {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 0.875rem 1rem;
            padding-right: 3rem;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            background: var(--white);
            color: var(--black);
            box-shadow: var(--shadow-md);
        }
        
        .search-input:focus {
            outline: 2px solid var(--maroon);
            outline-offset: 2px;
        }
        
        .search-button {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--maroon);
        }
        
        .slide-indicators {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 10px;
            z-index: 2;
        }
        
        .slide-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .slide-indicator.active {
            background: var(--white);
            transform: scale(1.2);
        }
        
        /* ==================== CATEGORIES ==================== */
        .categories {
            padding: 2rem 0;
            background: var(--white);
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
        }
        
        .category-card {
            background: var(--white);
            border-radius: var(--radius-md);
            padding: 1rem;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border: 1px solid var(--gray-200);
            cursor: pointer;
        }
        
        .category-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
            border-color: var(--maroon);
        }
        
        .category-card.active {
            border-color: var(--maroon);
            background: var(--maroon);
            color: var(--white);
        }
        
        .category-card.active .category-icon {
            background: var(--white);
            color: var(--maroon);
        }
        
        .category-icon {
            width: 48px;
            height: 48px;
            background: var(--maroon);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            font-size: 1.25rem;
            transition: var(--transition);
        }
        
        .category-name {
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .category-count {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-top: 0.25rem;
        }
        
        .category-card.active .category-count {
            color: rgba(255, 255, 255, 0.8);
        }
        
        /* ==================== PRODUCT GRID ==================== */
        .products-section {
            padding: 2rem 0;
            background: var(--gray-100);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .view-all {
            font-size: 0.875rem;
            color: var(--maroon);
            font-weight: 600;
            padding: 0.5rem 1rem;
            border: 1px solid var(--maroon);
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }
        
        .view-all:hover {
            background: var(--maroon);
            color: var(--white);
        }
        
        /* RESPONSIVE PRODUCT GRID */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1rem;
        }
        
        /* Small phones (320px+) */
        @media (min-width: 320px) {
            .product-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .category-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* Medium phones (375px+) */
        @media (min-width: 375px) {
            .product-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
        }
        
        /* Large phones (425px+) */
        @media (min-width: 425px) {
            .product-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.25rem;
            }
            
            .category-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* Tablets (640px+) */
        @media (min-width: 640px) {
            .product-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 1.5rem;
            }
            
            .category-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }
        
        /* Small laptops (768px+) */
        @media (min-width: 768px) {
            .product-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .category-grid {
                grid-template-columns: repeat(6, 1fr);
            }
            
            .hero h1 {
                font-size: 3rem;
            }
        }
        
        /* Large screens (1024px+) */
        @media (min-width: 1024px) {
            .product-grid {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .category-grid {
                grid-template-columns: repeat(7, 1fr);
            }
        }
        
        /* Extra large (1200px+) */
        @media (min-width: 1200px) {
            .product-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }
        
        .product-card {
            background: var(--white);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .product-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-4px);
        }
        
        .product-image {
            aspect-ratio: 1/1;
            background: var(--gray-100);
            position: relative;
            overflow: hidden;
        }
        
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .product-card:hover .product-image img {
            transform: scale(1.05);
        }
        
        .product-badge {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem;
            background: var(--maroon);
            color: var(--white);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.625rem;
            font-weight: 600;
            z-index: 2;
        }
        
        .product-content {
            padding: 0.75rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .product-title {
            font-size: 0.8125rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 2.5rem;
        }
        
        .product-price {
            font-size: 0.9375rem;
            font-weight: 700;
            color: var(--maroon);
            margin-bottom: 0.5rem;
        }
        
        .product-seller {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .seller-verified {
            color: #10b981;
            font-size: 0.75rem;
        }
        
        .product-rating {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            margin-bottom: 0.75rem;
        }
        
        .product-rating .stars {
            color: #fbbf24;
            font-size: 0.75rem;
        }
        
        .product-rating .count {
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        .product-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: auto;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            transition: var(--transition);
            white-space: nowrap;
            min-height: 36px;
        }
        
        .btn-primary {
            background: var(--maroon);
            color: var(--white);
            flex: 1;
        }
        
        .btn-primary:hover {
            background: var(--dark-maroon);
        }
        
        .btn-secondary {
            background: var(--gray-100);
            color: var(--black);
            min-width: 36px;
        }
        
        .btn-secondary:hover {
            background: var(--gray-200);
        }
        
        /* ==================== IMPROVED PRODUCT MODAL WITH IMAGE GALLERY ==================== */
        .product-gallery {
            position: relative;
            aspect-ratio: 1/1;
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: 1rem;
        }
        
        .gallery-main {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .gallery-main img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .gallery-thumbnails {
            display: flex;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--gray-100);
            border-radius: var(--radius-md);
            overflow-x: auto;
        }
        
        .thumbnail {
            width: 60px;
            height: 60px;
            flex-shrink: 0;
            border-radius: var(--radius-sm);
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }
        
        .thumbnail.active {
            border-color: var(--maroon);
        }
        
        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .gallery-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            z-index: 2;
        }
        
        .gallery-nav:hover {
            background: var(--white);
            transform: translateY(-50%) scale(1.1);
        }
        
        .gallery-prev {
            left: 10px;
        }
        
        .gallery-next {
            right: 10px;
        }
        
        .gallery-dots {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 8px;
            z-index: 2;
        }
        
        .gallery-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            transition: var(--transition);
        }
        
        .gallery-dot.active {
            background: var(--white);
            transform: scale(1.2);
        }
        
        /* ==================== FEATURED SECTION ==================== */
        .featured-section {
            padding: 3rem 0;
            background: linear-gradient(135deg, var(--maroon) 0%, var(--dark-maroon) 100%);
            color: var(--white);
        }
        
        .featured-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        .featured-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .featured-description {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        @media (min-width: 640px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        
        /* ==================== CHATBOT ==================== */
        .chatbot-toggle {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: var(--maroon);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: var(--shadow-lg);
            z-index: 98;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .chatbot-toggle:hover {
            background: var(--dark-maroon);
            transform: scale(1.1);
        }
        
        .chatbot-container {
            position: fixed;
            bottom: 170px;
            right: 20px;
            width: 350px;
            max-width: calc(100vw - 40px);
            height: 500px;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 97;
            overflow: hidden;
            transform: translateY(20px);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }
        
        .chatbot-container.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }
        
        .chatbot-header {
            background: var(--maroon);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chatbot-header h3 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }
        
        .chatbot-close {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .chatbot-close:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .chatbot-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .chat-message {
            max-width: 80%;
            padding: 0.75rem;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
        }
        
        .message-bot {
            background: var(--gray-100);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        
        .message-user {
            background: var(--maroon);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        
        .chatbot-input {
            padding: 1rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            gap: 0.5rem;
        }
        
        .chatbot-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
        }
        
        .chatbot-input input:focus {
            outline: 2px solid var(--maroon);
            outline-offset: -2px;
        }
        
        .chatbot-input button {
            background: var(--maroon);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chatbot-input button:hover {
            background: var(--dark-maroon);
        }
        
        .quick-questions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .quick-question {
            background: var(--gray-200);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .quick-question:hover {
            background: var(--gray-300);
        }
        
        /* ==================== FOOTER ==================== */
        .footer {
            background: var(--black);
            color: var(--white);
            padding: 3rem 0 1.5rem;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        @media (min-width: 640px) {
            .footer-content {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .footer-section h3 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--maroon);
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 0.5rem;
        }
        
        .footer-links a {
            font-size: 0.875rem;
            opacity: 0.8;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .footer-links a:hover {
            opacity: 1;
            color: var(--maroon);
        }
        
        .footer-contact {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.75rem;
            opacity: 0.6;
        }
        
        /* ==================== MODALS ==================== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--white);
            border-radius: var(--radius-md);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--maroon);
            color: var(--white);
        }
        
        .modal-title {
            font-weight: 700;
            font-size: 1.125rem;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            border-radius: 50%;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .modal-body {
            padding: 1rem;
        }
        
        /* ==================== TOAST ==================== */
        .toast {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: var(--black);
            color: var(--white);
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 1001;
            max-width: 300px;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            border-left: 4px solid #10b981;
        }
        
        .toast.error {
            border-left: 4px solid #ef4444;
        }
        
        .toast.info {
            border-left: 4px solid #3b82f6;
        }
        
        /* ==================== OFFLINE NOTIFICATION ==================== */
        .offline-notification {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #f59e0b;
            color: white;
            text-align: center;
            padding: 0.5rem;
            z-index: 1002;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }
        
        .offline-notification.show {
            transform: translateY(0);
        }
        
        /* ==================== LOADING STATES ==================== */
        .loading-state {
            text-align: center;
            padding: 2rem;
            grid-column: 1 / -1;
        }
        
        .skeleton-product {
            background: var(--white);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }
        
        .skeleton-product .product-image {
            aspect-ratio: 1/1;
            background: var(--gray-100);
        }
        
        .skeleton-product .product-content {
            padding: 0.75rem;
        }
        
        .skeleton-product .product-title {
            height: 1rem;
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            margin-bottom: 0.5rem;
        }
        
        .skeleton-product .product-price {
            height: 1.25rem;
            width: 60px;
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            margin-bottom: 0.5rem;
        }
        
        .skeleton-product .product-actions {
            height: 2.5rem;
            background: var(--gray-100);
            border-radius: var(--radius-sm);
        }
        
        .skeleton-category {
            background: var(--white);
            border-radius: var(--radius-md);
            padding: 1rem;
            text-align: center;
        }
        
        .skeleton-category .category-icon {
            width: 48px;
            height: 48px;
            background: var(--gray-100);
            border-radius: 50%;
            margin: 0 auto 0.5rem;
        }
        
        .skeleton-category .category-name {
            height: 0.875rem;
            width: 60px;
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            margin: 0 auto;
        }
        
        /* ==================== NO RESULTS ==================== */
        .no-results {
            text-align: center;
            padding: 3rem 1rem;
            grid-column: 1 / -1;
        }
        
        .no-results-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .no-results-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--black);
        }
        
        .no-results-message {
            color: var(--gray-500);
            margin-bottom: 1.5rem;
        }
        
        /* ==================== SAMPLE PRODUCTS WARNING ==================== */
        .sample-warning {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: var(--radius-md);
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideInDown 0.5s ease;
        }
        
        @keyframes slideInDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .sample-warning-icon {
            font-size: 1.5rem;
            color: #d97706;
        }
        
        .sample-warning-content {
            flex: 1;
        }
        
        .sample-warning-title {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 0.25rem;
        }
        
        .sample-warning-text {
            color: #92400e;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        
        /* ==================== LAZY LOADING ==================== */
        .lazy-image {
            opacity: 0;
            transition: opacity 0.3s ease;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .lazy-image.loaded {
            opacity: 1;
        }
        
        /* ==================== SCROLL TO TOP ==================== */
        .scroll-top {
            position: fixed;
            bottom: 2rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            background: var(--maroon);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: var(--transition);
            z-index: 99;
        }
        
        .scroll-top.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .scroll-top:hover {
            background: var(--dark-maroon);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Install Button -->
    <button class="install-button" id="installButton">
        üì± Install App
    </button>
    
    <!-- Offline Notification -->
    <div class="offline-notification" id="offlineNotification">
        ‚ö†Ô∏è You are offline. Some features may be limited.
    </div>
    
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">
                    <span class="logo-icon">S</span>
                    <span>SokoInn</span>
                </a>
                
                <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
        
        <nav class="mobile-nav" id="mobileNav">
            <a href="#categories">Categories</a>
            <a href="#products">Products</a>
            <a href="#featured">Why SokoInn</a>
            <a href="#" onclick="showSellerModal()">Become a Seller</a>
            <a href="#" onclick="showContactModal()">Contact</a>
        </nav>
        
        <div class="overlay" id="overlay"></div>
    </header>
    
    <!-- Hero Section with Slideshow -->
    <section class="hero" id="hero">
        <div class="hero-slideshow" id="heroSlideshow">
            <!-- Slides will be added dynamically -->
        </div>
        
        <div class="hero-content">
            <h1>Discover Quality Products from Trusted Kenyan Sellers</h1>
            <p>Shop directly with verified sellers. WhatsApp-first shopping experience.</p>
            
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="Search for products..." aria-label="Search products">
                <button class="search-button" id="searchButton" aria-label="Search">
                    üîç
                </button>
            </div>
        </div>
        
        <div class="slide-indicators" id="slideIndicators">
            <!-- Indicators will be added dynamically -->
        </div>
    </section>
    
    <!-- Sample Products Warning -->
    <div class="container" id="sampleWarningContainer"></div>
    
    <!-- Categories Section -->
    <section class="categories" id="categories">
        <div class="container">
            <h2 class="section-title">Shop by Category</h2>
            <div class="category-grid" id="categoryGrid">
                <!-- Categories will be loaded dynamically -->
            </div>
        </div>
    </section>
    
    <!-- Products Section -->
    <section class="products-section" id="products">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Featured Products</h2>
                <a href="#" class="view-all" id="viewAll">View All</a>
            </div>
            
            <div class="product-grid" id="productGrid">
                <!-- Products will be loaded dynamically -->
            </div>
            
            <div class="text-center mt-6">
                <button class="btn btn-primary" id="loadMore">
                    <span class="loading hidden" id="loadingSpinner"></span>
                    Load More Products
                </button>
            </div>
        </div>
    </section>
    
    <!-- Featured Section -->
    <section class="featured-section" id="featured">
        <div class="container">
            <div class="featured-content">
                <h2 class="featured-title">Why Choose SokoInn?</h2>
                <p class="featured-description">Connecting trusted sellers with quality-conscious buyers across Africa.</p>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="totalProducts">0</div>
                        <div class="stat-label">Products</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="activeSellers">0</div>
                        <div class="stat-label">Verified Sellers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="happyCustomers">0</div>
                        <div class="stat-label">Happy Customers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="citiesCovered">10+</div>
                        <div class="stat-label">Cities Covered</div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>SokoInn Marketplace</h3>
                    <div class="footer-contact">üìç Nairobi, Kenya</div>
                    <div class="footer-contact">üìß support@sokoinn.co.ke</div>
                    <div class="footer-contact">üì± +254 784 599 322</div>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#categories">Browse Categories</a></li>
                        <li><a href="#products">All Products</a></li>
                        <li><a href="#featured">Why SokoInn</a></li>
                        <li><a href="#" onclick="showSellerModal()">Become a Seller</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>For Sellers</h3>
                    <ul class="footer-links">
                        <li><a href="#" onclick="showSellerModal()">Register as Seller</a></li>
                        <li><a href="#" onclick="showSellerGuide()">Seller Guide</a></li>
                        <li><a href="#" onclick="showTerms()">Terms & Conditions</a></li>
                        <li><a href="#" onclick="showSupport()">Support Center</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 SokoInn Marketplace. All rights reserved. Building trust in African e-commerce.</p>
            </div>
        </div>
    </footer>
    
    <!-- Chatbot -->
    <div class="chatbot-toggle" id="chatbotToggle">
        ü§ñ
    </div>
    
    <div class="chatbot-container" id="chatbotContainer">
        <div class="chatbot-header">
            <h3><span>ü§ñ</span> SokoInn Assistant</h3>
            <button class="chatbot-close" id="chatbotClose">‚úï</button>
        </div>
        <div class="chatbot-messages" id="chatbotMessages">
            <div class="chat-message message-bot">
                Hello! I'm your SokoInn assistant. How can I help you today? üòä
            </div>
            <div class="chat-message message-bot">
                Here are some quick questions I can answer:
                <div class="quick-questions">
                    <div class="quick-question" onclick="askQuestion('How do I buy products?')">How do I buy products?</div>
                    <div class="quick-question" onclick="askQuestion('How to become a seller?')">How to become a seller?</div>
                    <div class="quick-question" onclick="askQuestion('Payment methods')">Payment methods</div>
                    <div class="quick-question" onclick="askQuestion('Delivery information')">Delivery information</div>
                </div>
            </div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatbotInput" placeholder="Type your question...">
            <button id="chatbotSend">‚û§</button>
        </div>
    </div>
    
    <!-- Scroll to Top Button -->
    <button class="scroll-top" id="scrollTop" aria-label="Scroll to top">
        ‚Üë
    </button>
    
    <!-- Product Detail Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Product Details</h3>
                <button class="modal-close" id="closeProductModal">‚úï</button>
            </div>
            <div class="modal-body" id="productModalBody">
                <!-- Product details will be loaded dynamically -->
            </div>
        </div>
    </div>
    
    <!-- Seller Registration Modal -->
    <div class="modal" id="sellerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Register as Seller</h3>
                <button class="modal-close" id="closeSellerModal">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="sellerForm">
                    <div class="mb-3">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--black);">Business Name *</label>
                        <input type="text" class="search-input" style="width: 100%;" name="businessName" required>
                    </div>
                    
                    <div class="mb-3">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--black);">Your Name *</label>
                        <input type="text" class="search-input" style="width: 100%;" name="ownerName" required>
                    </div>
                    
                    <div class="mb-3">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--black);">WhatsApp Number *</label>
                        <input type="tel" class="search-input" style="width: 100%;" name="whatsappNumber" required placeholder="254712345678">
                    </div>
                    
                    <div class="mb-3">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--black);">Email Address</label>
                        <input type="email" class="search-input" style="width: 100%;" name="email" placeholder="your@email.com">
                    </div>
                    
                    <div class="mb-3">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--black);">Business Location *</label>
                        <input type="text" class="search-input" style="width: 100%;" name="location" required placeholder="e.g., Nairobi, Kenya">
                    </div>
                    
                    <div class="mb-4">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--black);">Products You Sell *</label>
                        <textarea class="search-input" style="width: 100%; min-height: 100px;" name="products" required placeholder="Describe the types of products you sell..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-full" id="submitSellerBtn">
                        Submit Application
                    </button>
                    
                    <p class="text-xs text-gray-500 mt-3">
                        We'll contact you via WhatsApp within 24 hours to verify your account and activate your seller profile.
                    </p>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
    
    <!-- Service Worker Registration -->
    <script>
        // ==================== PWA SERVICE WORKER ====================
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js').then(
                    function(registration) {
                        console.log('Service Worker registered with scope:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('New service worker found!');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showToast('New version available! Refresh to update.', 'info');
                                }
                            });
                        });
                    },
                    function(err) {
                        console.log('Service Worker registration failed:', err);
                    }
                );
                
                // Check if app is already installed
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    window.deferredPrompt = e;
                    showInstallButton();
                });
                
                // Check if app is already installed
                window.addEventListener('appinstalled', () => {
                    console.log('App installed successfully');
                    window.deferredPrompt = null;
                    hideInstallButton();
                    showToast('App installed successfully!', 'success');
                });
            });
        }
        
        // ==================== MANIFEST CREATION ====================
        function createManifest() {
            const manifest = {
                "name": "SokoInn Marketplace",
                "short_name": "SokoInn",
                "description": "Trusted Sellers, Quality Products - African E-commerce",
                "start_url": "/",
                "display": "standalone",
                "background_color": "#800000",
                "theme_color": "#800000",
                "orientation": "portrait",
                "icons": [
                    {
                        "src": "icons/icon-72.png",
                        "sizes": "72x72",
                        "type": "image/png"
                    },
                    {
                        "src": "icons/icon-96.png",
                        "sizes": "96x96",
                        "type": "image/png"
                    },
                    {
                        "src": "icons/icon-128.png",
                        "sizes": "128x128",
                        "type": "image/png"
                    },
                    {
                        "src": "icons/icon-144.png",
                        "sizes": "144x144",
                        "type": "image/png"
                    },
                    {
                        "src": "icons/icon-152.png",
                        "sizes": "152x152",
                        "type": "image/png"
                    },
                    {
                        "src": "icons/icon-192.png",
                        "sizes": "192x192",
                        "type": "image/png"
                    },
                    {
                        "src": "icons/icon-384.png",
                        "sizes": "384x384",
                        "type": "image/png"
                    },
                    {
                        "src": "icons/icon-512.png",
                        "sizes": "512x512",
                        "type": "image/png"
                    }
                ],
                "screenshots": [
                    {
                        "src": "screenshots/screenshot1.png",
                        "sizes": "1280x720",
                        "type": "image/png",
                        "form_factor": "wide"
                    },
                    {
                        "src": "screenshots/screenshot2.png",
                        "sizes": "750x1334",
                        "type": "image/png",
                        "form_factor": "narrow"
                    }
                ],
                "categories": ["shopping", "business", "lifestyle"],
                "shortcuts": [
                    {
                        "name": "Browse Products",
                        "short_name": "Products",
                        "description": "Browse all available products",
                        "url": "/#products"
                    },
                    {
                        "name": "Become a Seller",
                        "short_name": "Seller",
                        "description": "Register as a seller",
                        "url": "/?action=seller"
                    }
                ]
            };
            
            // Create manifest link dynamically
            const link = document.createElement('link');
            link.rel = 'manifest';
            link.href = 'data:application/manifest+json,' + encodeURIComponent(JSON.stringify(manifest));
            document.head.appendChild(link);
        }
        
        // Create manifest on page load
        createManifest();
    </script>
    
    <!-- Main App Script -->
    <script>
        // ==================== CONFIGURATION ====================
        const CONFIG = {
            BACKEND_URL: 'https://script.google.com/macros/s/AKfycbxFV5ZB1KikI62uxGKU3XWZCk6nOUqE05R0MSK6LuzRKQWqwidMVQ1yDvEQ045vCmW4_w/exec',
            ITEMS_PER_PAGE: 12,
            DEFAULT_IMAGE: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="400" viewBox="0 0 400 400"><rect width="400" height="400" fill="%23f5f5f5"/><text x="50%" y="50%" font-family="Arial" font-size="24" fill="%23999" text-anchor="middle" dy=".3em">Image</text></svg>',
            
            // African city images for hero slideshow
            HERO_IMAGES: [
                'https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?w=1200&h=600&fit=crop', // Nairobi
                'https://images.unsplash.com/photo-1547471080-7cc2caa01a7e?w=1200&h=600&fit=crop', // Cape Town
                'https://images.unsplash.com/photo-1523805009345-7448845a9e53?w=1200&h=600&fit=crop', // Lagos
                'https://images.unsplash.com/photo-1532372576444-dda954194ad0?w=1200&h=600&fit=crop', // Accra
                'https://images.unsplash.com/photo-1557223562-6c77ef16210f?w=1200&h=600&fit=crop'  // Market scene
            ],
            
            // Category icons mapping
            CATEGORY_ICONS: {
                'fashion': 'üëï',
                'electronics': 'üì±',
                'home': 'üè†',
                'beauty': 'üíÑ',
                'sports': '‚öΩ',
                'books': 'üìö',
                'food': 'üçé',
                'art': 'üé®',
                'bags': 'üëú',
                'shoes': 'üë†',
                'jewelry': 'üíç',
                'toys': 'üß∏',
                'automotive': 'üöó',
                'health': 'üíä',
                'garden': 'üåø',
                'office': 'üíº',
                'pets': 'üêï',
                'baby': 'üë∂',
                'music': 'üéµ',
                'movies': 'üé¨'
            },
            
            // Chatbot responses
            CHATBOT_RESPONSES: {
                'greeting': ['Hello! üòä How can I assist you today?', 'Hi there! Ready to help you shop.'],
                'buy': [
                    'To buy products: 1) Browse products 2) Click "View" 3) Contact seller via WhatsApp 4) Arrange payment & delivery',
                    'Simply browse products, contact the seller directly on WhatsApp, and arrange your purchase!'
                ],
                'seller': [
                    'Click "Become a Seller" in the menu or footer. Fill the form and we\'ll contact you within 24 hours!',
                    'Register as a seller using the form. We verify all sellers to ensure trust and quality.'
                ],
                'payment': [
                    'Sellers accept various methods: M-Pesa, bank transfer, cash on delivery. Discuss directly with the seller.',
                    'Payment methods vary by seller. Most accept M-Pesa. Discuss payment options when you contact the seller.'
                ],
                'delivery': [
                    'Delivery arrangements are made directly with sellers. They can deliver or you can pick up locally.',
                    'Each seller handles their own delivery. You\'ll arrange this when you contact them on WhatsApp.'
                ],
                'default': [
                    "I'm not sure about that. Would you like me to connect you with our support team via WhatsApp?",
                    "That's a great question! Let me connect you with a human agent for more help."
                ]
            }
        };
        
        // ==================== STATE MANAGEMENT ====================
        let state = {
            products: [],
            filteredProducts: [],
            categories: [],
            currentPage: 1,
            isLoading: false,
            selectedCategory: 'all',
            searchQuery: '',
            usingSampleProducts: false,
            currentSlide: 0,
            heroInterval: null,
            chatHistory: []
        };
        
        // ==================== DOM ELEMENTS ====================
        const elements = {
            // PWA Elements
            installButton: document.getElementById('installButton'),
            offlineNotification: document.getElementById('offlineNotification'),
            
            // Navigation
            navToggle: document.getElementById('navToggle'),
            mobileNav: document.getElementById('mobileNav'),
            overlay: document.getElementById('overlay'),
            
            // Hero
            heroSlideshow: document.getElementById('heroSlideshow'),
            slideIndicators: document.getElementById('slideIndicators'),
            
            // Warning
            sampleWarningContainer: document.getElementById('sampleWarningContainer'),
            
            // Search
            searchInput: document.getElementById('searchInput'),
            searchButton: document.getElementById('searchButton'),
            
            // Content
            categoryGrid: document.getElementById('categoryGrid'),
            productGrid: document.getElementById('productGrid'),
            loadMore: document.getElementById('loadMore'),
            loadingSpinner: document.getElementById('loadingSpinner'),
            viewAll: document.getElementById('viewAll'),
            
            // Stats
            totalProducts: document.getElementById('totalProducts'),
            activeSellers: document.getElementById('activeSellers'),
            happyCustomers: document.getElementById('happyCustomers'),
            citiesCovered: document.getElementById('citiesCovered'),
            
            // Scroll
            scrollTop: document.getElementById('scrollTop'),
            
            // Chatbot
            chatbotToggle: document.getElementById('chatbotToggle'),
            chatbotContainer: document.getElementById('chatbotContainer'),
            chatbotClose: document.getElementById('chatbotClose'),
            chatbotMessages: document.getElementById('chatbotMessages'),
            chatbotInput: document.getElementById('chatbotInput'),
            chatbotSend: document.getElementById('chatbotSend'),
            
            // Modals
            productModal: document.getElementById('productModal'),
            closeProductModal: document.getElementById('closeProductModal'),
            productModalBody: document.getElementById('productModalBody'),
            sellerModal: document.getElementById('sellerModal'),
            closeSellerModal: document.getElementById('closeSellerModal'),
            sellerForm: document.getElementById('sellerForm'),
            submitSellerBtn: document.getElementById('submitSellerBtn'),
            
            // Toast
            toast: document.getElementById('toast')
        };
        
        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', () => {
            initNavigation();
            initSearch();
            initModals();
            initScrollToTop();
            initHeroSlideshow();
            initChatbot();
            initNetworkStatus();
            loadInitialData();
            setupLazyLoading();
        });
        
        // ==================== PWA INSTALLATION ====================
        function showInstallButton() {
            elements.installButton.style.display = 'flex';
        }
        
        function hideInstallButton() {
            elements.installButton.style.display = 'none';
        }
        
        elements.installButton.addEventListener('click', async () => {
            if (!window.deferredPrompt) return;
            
            window.deferredPrompt.prompt();
            const { outcome } = await window.deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('User accepted the install prompt');
                hideInstallButton();
            } else {
                console.log('User dismissed the install prompt');
            }
            
            window.deferredPrompt = null;
        });
        
        // ==================== NETWORK STATUS ====================
        function initNetworkStatus() {
            window.addEventListener('online', () => {
                elements.offlineNotification.classList.remove('show');
                showToast('You are back online!', 'success');
            });
            
            window.addEventListener('offline', () => {
                elements.offlineNotification.classList.add('show');
                showToast('You are offline', 'error');
            });
            
            // Initial check
            if (!navigator.onLine) {
                elements.offlineNotification.classList.add('show');
            }
        }
        
        // ==================== HERO SLIDESHOW ====================
        function initHeroSlideshow() {
            const slideshow = elements.heroSlideshow;
            const indicators = elements.slideIndicators;
            
            // Create slides
            CONFIG.HERO_IMAGES.forEach((image, index) => {
                const slide = document.createElement('div');
                slide.className = `hero-slide ${index === 0 ? 'active' : ''}`;
                slide.style.backgroundImage = `url('${image}')`;
                slideshow.appendChild(slide);
                
                const indicator = document.createElement('div');
                indicator.className = `slide-indicator ${index === 0 ? 'active' : ''}`;
                indicator.addEventListener('click', () => goToSlide(index));
                indicators.appendChild(indicator);
            });
            
            // Start slideshow
            startSlideshow();
            
            // Pause on hover
            slideshow.addEventListener('mouseenter', pauseSlideshow);
            slideshow.addEventListener('mouseleave', startSlideshow);
            
            // Touch support for mobile
            let touchStartX = 0;
            slideshow.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                pauseSlideshow();
            });
            
            slideshow.addEventListener('touchend', (e) => {
                const touchEndX = e.changedTouches[0].clientX;
                const diff = touchStartX - touchEndX;
                
                if (Math.abs(diff) > 50) {
                    if (diff > 0) {
                        nextSlide();
                    } else {
                        prevSlide();
                    }
                }
                
                setTimeout(startSlideshow, 3000);
            });
        }
        
        function startSlideshow() {
            if (state.heroInterval) clearInterval(state.heroInterval);
            
            state.heroInterval = setInterval(() => {
                nextSlide();
            }, 5000);
        }
        
        function pauseSlideshow() {
            if (state.heroInterval) {
                clearInterval(state.heroInterval);
                state.heroInterval = null;
            }
        }
        
        function nextSlide() {
            const slides = document.querySelectorAll('.hero-slide');
            const indicators = document.querySelectorAll('.slide-indicator');
            
            slides[state.currentSlide].classList.remove('active');
            indicators[state.currentSlide].classList.remove('active');
            
            state.currentSlide = (state.currentSlide + 1) % slides.length;
            
            slides[state.currentSlide].classList.add('active');
            indicators[state.currentSlide].classList.add('active');
        }
        
        function prevSlide() {
            const slides = document.querySelectorAll('.hero-slide');
            const indicators = document.querySelectorAll('.slide-indicator');
            
            slides[state.currentSlide].classList.remove('active');
            indicators[state.currentSlide].classList.remove('active');
            
            state.currentSlide = (state.currentSlide - 1 + slides.length) % slides.length;
            
            slides[state.currentSlide].classList.add('active');
            indicators[state.currentSlide].classList.add('active');
        }
        
        function goToSlide(index) {
            const slides = document.querySelectorAll('.hero-slide');
            const indicators = document.querySelectorAll('.slide-indicator');
            
            slides[state.currentSlide].classList.remove('active');
            indicators[state.currentSlide].classList.remove('active');
            
            state.currentSlide = index;
            
            slides[state.currentSlide].classList.add('active');
            indicators[state.currentSlide].classList.add('active');
            
            // Restart slideshow
            startSlideshow();
        }
        
        // ==================== CHATBOT ====================
        function initChatbot() {
            elements.chatbotToggle.addEventListener('click', toggleChatbot);
            elements.chatbotClose.addEventListener('click', toggleChatbot);
            elements.chatbotSend.addEventListener('click', sendChatMessage);
            
            elements.chatbotInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });
        }
        
        function toggleChatbot() {
            elements.chatbotContainer.classList.toggle('active');
            
            if (elements.chatbotContainer.classList.contains('active')) {
                elements.chatbotInput.focus();
            }
        }
        
        function sendChatMessage() {
            const message = elements.chatbotInput.value.trim();
            if (!message) return;
            
            // Add user message
            addChatMessage(message, 'user');
            
            // Clear input
            elements.chatbotInput.value = '';
            
            // Simulate typing delay
            setTimeout(() => {
                const response = getChatbotResponse(message);
                addChatMessage(response, 'bot');
                
                // Scroll to bottom
                elements.chatbotMessages.scrollTop = elements.chatbotMessages.scrollHeight;
                
                // Add to history
                state.chatHistory.push({ question: message, response });
            }, 500);
        }
        
        function addChatMessage(message, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message message-${sender}`;
            messageDiv.textContent = message;
            elements.chatbotMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            elements.chatbotMessages.scrollTop = elements.chatbotMessages.scrollHeight;
        }
        
        function getChatbotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Check for keywords
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                return randomResponse('greeting');
            } else if (lowerMessage.includes('buy') || lowerMessage.includes('purchase') || lowerMessage.includes('shop')) {
                return randomResponse('buy');
            } else if (lowerMessage.includes('seller') || lowerMessage.includes('sell')) {
                return randomResponse('seller');
            } else if (lowerMessage.includes('payment') || lowerMessage.includes('pay') || lowerMessage.includes('mpesa')) {
                return randomResponse('payment');
            } else if (lowerMessage.includes('delivery') || lowerMessage.includes('ship') || lowerMessage.includes('deliver')) {
                return randomResponse('delivery');
            } else if (lowerMessage.includes('whatsapp') || lowerMessage.includes('contact') || lowerMessage.includes('help')) {
                // Suggest WhatsApp for complex queries
                setTimeout(() => {
                    if (confirm("Would you like to chat with a human agent on WhatsApp?")) {
                        window.open('https://wa.me/254712345678?text=Hi%20SokoInn%20Support,%20I%20need%20help%20with%3A%20' + encodeURIComponent(message), '_blank');
                    }
                }, 100);
                return "I can connect you with our support team on WhatsApp for more detailed help!";
            } else {
                return randomResponse('default');
            }
        }
        
        function randomResponse(type) {
            const responses = CONFIG.CHATBOT_RESPONSES[type] || CONFIG.CHATBOT_RESPONSES.default;
            return responses[Math.floor(Math.random() * responses.length)];
        }
        
        window.askQuestion = function(question) {
            elements.chatbotInput.value = question;
            sendChatMessage();
        };
        
        // ==================== NAVIGATION ====================
        function initNavigation() {
            elements.navToggle.addEventListener('click', toggleMobileNav);
            elements.overlay.addEventListener('click', closeMobileNav);
            
            // Close mobile nav when clicking links
            elements.mobileNav.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', closeMobileNav);
            });
        }
        
        function toggleMobileNav() {
            elements.navToggle.classList.toggle('active');
            elements.mobileNav.classList.toggle('active');
            elements.overlay.classList.toggle('active');
            document.body.style.overflow = elements.mobileNav.classList.contains('active') ? 'hidden' : '';
        }
        
        function closeMobileNav() {
            elements.navToggle.classList.remove('active');
            elements.mobileNav.classList.remove('active');
            elements.overlay.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        // ==================== SCROLL TO TOP ====================
        function initScrollToTop() {
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > 300) {
                    elements.scrollTop.classList.add('visible');
                } else {
                    elements.scrollTop.classList.remove('visible');
                }
            });
            
            elements.scrollTop.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }
        
        // ==================== SEARCH FUNCTIONALITY ====================
        function initSearch() {
            let searchTimeout;
            
            elements.searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    state.searchQuery = e.target.value.toLowerCase().trim();
                    filterProducts();
                }, 300);
            });
            
            elements.searchButton.addEventListener('click', () => {
                state.searchQuery = elements.searchInput.value.toLowerCase().trim();
                filterProducts();
            });
        }
        
        // ==================== MODAL MANAGEMENT ====================
        function initModals() {
            // Product modal
            elements.closeProductModal.addEventListener('click', () => {
                elements.productModal.classList.remove('active');
                document.body.style.overflow = '';
            });
            
            elements.productModal.addEventListener('click', (e) => {
                if (e.target === elements.productModal) {
                    elements.productModal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
            
            // Seller modal
            elements.closeSellerModal.addEventListener('click', () => {
                elements.sellerModal.classList.remove('active');
                document.body.style.overflow = '';
            });
            
            elements.sellerModal.addEventListener('click', (e) => {
                if (e.target === elements.sellerModal) {
                    elements.sellerModal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
            
            // Seller form submission
            elements.sellerForm.addEventListener('submit', handleSellerRegistration);
            
            // Close modals on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    elements.productModal.classList.remove('active');
                    elements.sellerModal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        }
        
        function showSellerModal() {
            elements.sellerModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function showProductModal() {
            elements.productModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        // ==================== DATA LOADING ====================
        async function loadInitialData() {
            // Show skeleton loaders
            showSkeletonLoaders();
            
            // Load categories first (fast)
            await loadCategories();
            
            // Then load products
            await loadProducts();
            
            // Load stats in background
            loadStats();
        }
        
        async function loadCategories() {
            try {
                // Clear skeleton
                elements.categoryGrid.innerHTML = '';
                
                // Try to load from backend
                const response = await fetch(`${CONFIG.BACKEND_URL}?action=getCategories`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    state.categories = data.data;
                } else {
                    // If backend fails, extract from products or use defaults
                    await loadProducts(true); // Load products first to get categories
                    extractCategoriesFromProducts();
                }
                
                renderCategories();
            } catch (error) {
                console.error('Error loading categories:', error);
                // Use default categories
                state.categories = [
                    { name: 'Fashion', icon: 'üëï', count: 0 },
                    { name: 'Electronics', icon: 'üì±', count: 0 },
                    { name: 'Home & Living', icon: 'üè†', count: 0 },
                    { name: 'Beauty', icon: 'üíÑ', count: 0 },
                    { name: 'Sports', icon: '‚öΩ', count: 0 },
                    { name: 'Food', icon: 'üçé', count: 0 }
                ];
                renderCategories();
            }
        }
        
        function extractCategoriesFromProducts() {
            if (state.products.length === 0) return;
            
            const categoryMap = {};
            state.products.forEach(product => {
                if (product.category) {
                    const category = product.category.trim();
                    if (!categoryMap[category]) {
                        categoryMap[category] = {
                            name: category,
                            icon: CONFIG.CATEGORY_ICONS[category.toLowerCase()] || 'üì¶',
                            count: 0
                        };
                    }
                    categoryMap[category].count++;
                }
            });
            
            state.categories = Object.values(categoryMap);
        }
        
        async function loadProducts(silent = false) {
            if (state.isLoading) return;
            
            state.isLoading = true;
            
            if (!silent) {
                elements.loadingSpinner.classList.remove('hidden');
                elements.loadMore.disabled = true;
            }
            
            try {
                const response = await fetch(`${CONFIG.BACKEND_URL}?action=getProducts&limit=50`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    state.products = data.data.map(product => ({
                        ...product,
                        images: product.images || [CONFIG.DEFAULT_IMAGE],
                        rating: product.rating || 4.0,
                        reviewCount: product.reviewCount || 0,
                        stock: product.stock || 10,
                        sellerStatus: product.sellerStatus || 'verified'
                    }));
                    
                    state.usingSampleProducts = false;
                    state.filteredProducts = [...state.products];
                    renderProducts();
                    hideSampleWarning();
                    
                    // Update stats
                    updateProductCount();
                    
                    if (!silent) {
                        showToast(`${state.products.length} products loaded`, 'success');
                    }
                } else {
                    throw new Error(data.message || 'Failed to load products');
                }
            } catch (error) {
                console.error('Error loading products:', error);
                
                // Load sample products as fallback
                loadSampleProducts();
                
                if (!silent) {
                    showToast('Using sample products - reload for real data', 'info');
                }
            } finally {
                state.isLoading = false;
                elements.loadingSpinner.classList.add('hidden');
                elements.loadMore.disabled = false;
            }
        }
        
        function loadSampleProducts() {
            const sampleProducts = [
                {
                    productId: 'PROD001',
                    name: 'Genuine Leather Handbag',
                    price: 4500,
                    sellerId: 'SELL001',
                    sellerName: 'Luxury Bags Kenya',
                    sellerStatus: 'verified',
                    images: [
                        'https://images.unsplash.com/photo-1584917865442-de89df76afd3?w-800&h-800&fit=crop',
                        'https://images.unsplash.com/photo-1594223274512-ad4803739b7c?w-800&h-800&fit=crop',
                        'https://images.unsplash.com/photo-1584917865442-de89df76afd3?w-800&h-800&fit=crop'
                    ],
                    rating: 4.5,
                    reviewCount: 24,
                    category: 'Fashion',
                    stock: 5,
                    description: 'Premium genuine leather handbag with multiple compartments.'
                },
                {
                    productId: 'PROD002',
                    name: 'Traditional African Wall Art',
                    price: 3200,
                    sellerId: 'SELL002',
                    sellerName: 'African Art Gallery',
                    sellerStatus: 'verified',
                    images: [
                        'https://images.unsplash.com/photo-1541961017774-22349e4a1262?w-800&h-800&fit=crop',
                        'https://images.unsplash.com/photo-1578301978693-85fa9c0320b9?w-800&h-800&fit=crop'
                    ],
                    rating: 4.8,
                    reviewCount: 18,
                    category: 'Home & Living',
                    stock: 3,
                    description: 'Beautiful traditional African art piece for home decoration.'
                },
                {
                    productId: 'PROD003',
                    name: 'Wireless Bluetooth Headphones',
                    price: 2800,
                    sellerId: 'SELL003',
                    sellerName: 'Tech Gadgets KE',
                    sellerStatus: 'verified',
                    images: [
                        'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w-800&h-800&fit=crop',
                        'https://images.unsplash.com/photo-1484704849700-f032a568e944?w-800&h-800&fit=crop'
                    ],
                    rating: 4.2,
                    reviewCount: 36,
                    category: 'Electronics',
                    stock: 8,
                    description: 'High-quality wireless headphones with noise cancellation.'
                },
                {
                    productId: 'PROD004',
                    name: 'Organic Shea Butter Cream',
                    price: 1500,
                    sellerId: 'SELL004',
                    sellerName: 'Natural Beauty Hub',
                    sellerStatus: 'verified',
                    images: [
                        'https://images.unsplash.com/photo-1556228578-9c360e1d8d34?w-800&h-800&fit=crop',
                        'https://images.unsplash.com/photo-1596462502278-27bfdc403348?w-800&h-800&fit=crop'
                    ],
                    rating: 4.7,
                    reviewCount: 42,
                    category: 'Beauty',
                    stock: 12,
                    description: '100% organic shea butter for skin and hair care.'
                },
                {
                    productId: 'PROD005',
                    name: 'Maasai Beaded Sandals',
                    price: 2200,
                    sellerId: 'SELL005',
                    sellerName: 'Cultural Crafts Ltd',
                    sellerStatus: 'verified',
                    images: [
                        'https://images.unsplash.com/photo-1543163521-1bf539c55dd2?w-800&h-800&fit=crop',
                        'https://images.unsplash.com/photo-1575537302964-96d34b3e42c6?w-800&h-800&fit=crop'
                    ],
                    rating: 4.9,
                    reviewCount: 29,
                    category: 'Fashion',
                    stock: 4,
                    description: 'Handcrafted Maasai beaded sandals with traditional designs.'
                },
                {
                    productId: 'PROD006',
                    name: 'Kenyan Coffee Beans (500g)',
                    price: 1800,
                    sellerId: 'SELL006',
                    sellerName: 'Farm Fresh Products',
                    sellerStatus: 'verified',
                    images: [
                        'https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w-800&h-800&fit=crop',
                        'https://images.unsplash.com/photo-1510707577719-ae7c9b788690?w-800&h-800&fit=crop'
                    ],
                    rating: 4.6,
                    reviewCount: 51,
                    category: 'Food',
                    stock: 15,
                    description: 'Premium Arabica coffee beans from Kenyan highlands.'
                }
            ];
            
            state.products = sampleProducts;
            state.filteredProducts = [...sampleProducts];
            state.usingSampleProducts = true;
            renderProducts();
            updateProductCount();
            showSampleWarning();
        }
        
        async function loadStats() {
            try {
                const response = await fetch(`${CONFIG.BACKEND_URL}?action=getDashboardStats`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    updateStatsDisplay(data.data);
                }
            } catch (error) {
                console.error('Error loading stats:', error);
                // Set default stats
                updateStatsDisplay({
                    totalProducts: state.products.length,
                    activeSellers: state.usingSampleProducts ? 6 : 0,
                    totalCustomers: state.usingSampleProducts ? 1289 : 0,
                    cities: 10
                });
            }
        }
        
        // ==================== SAMPLE PRODUCTS WARNING ====================
        function showSampleWarning() {
            elements.sampleWarningContainer.innerHTML = `
                <div class="sample-warning">
                    <div class="sample-warning-icon">‚ö†Ô∏è</div>
                    <div class="sample-warning-content">
                        <div class="sample-warning-title">Sample Products Loaded</div>
                        <div class="sample-warning-text">
                            You're viewing sample products. Real products from our sellers will load when you're connected to the backend.
                        </div>
                        <button class="btn btn-primary" onclick="window.location.reload()" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;">
                            Reload Page
                        </button>
                    </div>
                </div>
            `;
        }
        
        function hideSampleWarning() {
            elements.sampleWarningContainer.innerHTML = '';
        }
        
        // ==================== RENDERING ====================
        function showSkeletonLoaders() {
            // Product skeletons
            const productSkeletons = Array(8).fill().map(() => `
                <div class="skeleton-product">
                    <div class="product-image skeleton"></div>
                    <div class="product-content">
                        <div class="product-title skeleton"></div>
                        <div class="product-price skeleton"></div>
                        <div class="product-actions skeleton"></div>
                    </div>
                </div>
            `).join('');
            
            elements.productGrid.innerHTML = productSkeletons;
            
            // Category skeletons
            const categorySkeletons = Array(6).fill().map(() => `
                <div class="skeleton-category">
                    <div class="category-icon skeleton"></div>
                    <div class="category-name skeleton"></div>
                </div>
            `).join('');
            
            elements.categoryGrid.innerHTML = categorySkeletons;
        }
        
        function renderCategories() {
            if (!state.categories.length) return;
            
            elements.categoryGrid.innerHTML = '';
            
            // Add "All" category
            const allCategory = document.createElement('div');
            allCategory.className = `category-card ${state.selectedCategory === 'all' ? 'active' : ''}`;
            allCategory.innerHTML = `
                <div class="category-icon">üì¶</div>
                <div class="category-name">All</div>
                <div class="category-count">${state.products.length}</div>
            `;
            allCategory.addEventListener('click', () => {
                state.selectedCategory = 'all';
                filterProducts();
                updateActiveCategory();
            });
            elements.categoryGrid.appendChild(allCategory);
            
            // Add other categories
            state.categories.forEach(category => {
                const categoryKey = category.name.toLowerCase().replace(/[^a-z0-9]/g, '-');
                const isActive = state.selectedCategory === categoryKey;
                
                const categoryElement = document.createElement('div');
                categoryElement.className = `category-card ${isActive ? 'active' : ''}`;
                categoryElement.innerHTML = `
                    <div class="category-icon">${category.icon || 'üì¶'}</div>
                    <div class="category-name">${category.name}</div>
                    <div class="category-count">${category.count || 0}</div>
                `;
                categoryElement.addEventListener('click', () => {
                    state.selectedCategory = isActive ? 'all' : categoryKey;
                    filterProducts();
                    updateActiveCategory();
                });
                elements.categoryGrid.appendChild(categoryElement);
            });
        }
        
        function updateActiveCategory() {
            const categoryCards = elements.categoryGrid.querySelectorAll('.category-card');
            categoryCards.forEach(card => {
                const categoryName = card.querySelector('.category-name').textContent;
                const categoryKey = categoryName === 'All' ? 'all' : 
                    categoryName.toLowerCase().replace(/[^a-z0-9]/g, '-');
                
                card.classList.toggle('active', state.selectedCategory === categoryKey);
            });
        }
        
        function renderProducts() {
            const startIndex = 0;
            const endIndex = state.currentPage * CONFIG.ITEMS_PER_PAGE;
            const productsToShow = state.filteredProducts.slice(startIndex, endIndex);
            
            if (productsToShow.length === 0) {
                elements.productGrid.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">üîç</div>
                        <h3 class="no-results-title">No products found</h3>
                        <p class="no-results-message">
                            ${state.searchQuery ? 'Try a different search term' : 'No products available in this category'}
                        </p>
                        ${state.searchQuery || state.selectedCategory !== 'all' ? `
                            <button class="btn btn-primary" onclick="clearFilters()">
                                Clear Filters
                            </button>
                        ` : ''}
                    </div>
                `;
                elements.loadMore.style.display = 'none';
                return;
            }
            
            elements.productGrid.innerHTML = productsToShow.map(product => {
                const imageUrl = product.images?.[0] || CONFIG.DEFAULT_IMAGE;
                const isLowStock = product.stock > 0 && product.stock <= 3;
                const isOutOfStock = product.stock === 0;
                
                return `
                <div class="product-card" data-id="${product.productId}">
                    ${isLowStock ? `<span class="product-badge">Low Stock</span>` : ''}
                    ${isOutOfStock ? `<span class="product-badge" style="background: var(--gray-500);">Sold Out</span>` : ''}
                    
                    <div class="product-image">
                        <img 
                            src="${imageUrl}" 
                            alt="${product.name}"
                            loading="lazy"
                            class="lazy-image"
                            onload="this.classList.add('loaded')"
                            onerror="this.src='${CONFIG.DEFAULT_IMAGE}'; this.classList.add('loaded')"
                        >
                    </div>
                    
                    <div class="product-content">
                        <h3 class="product-title">${product.name}</h3>
                        <div class="product-price">KSh ${product.price.toLocaleString()}</div>
                        
                        <div class="product-seller">
                            ${product.sellerName}
                            ${product.sellerStatus === 'verified' ? '<span class="seller-verified">‚úì</span>' : ''}
                        </div>
                        
                        <div class="product-rating">
                            <div class="stars">
                                ${'‚òÖ'.repeat(Math.floor(product.rating))}${'‚òÜ'.repeat(5 - Math.floor(product.rating))}
                            </div>
                            <span class="count">(${product.reviewCount})</span>
                        </div>
                        
                        <div class="product-actions">
                            <button class="btn btn-primary" onclick="viewProduct('${product.productId}')">
                                View
                            </button>
                            <button class="btn btn-secondary" onclick="contactSeller('${product.sellerId}', '${product.name}', ${product.price})" title="WhatsApp">
                                üí¨
                            </button>
                        </div>
                    </div>
                </div>
            `}).join('');
            
            // Update load more button
            elements.loadMore.style.display = 
                state.filteredProducts.length > productsToShow.length ? 'inline-flex' : 'none';
            
            // Trigger lazy loading
            lazyLoadImages();
        }
        
        // ==================== IMPROVED PRODUCT MODAL ====================
        async function viewProduct(productId) {
            showProductModal();
            
            elements.productModalBody.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div class="loading" style="width: 40px; height: 40px; margin: 0 auto 1rem;"></div>
                    <p style="color: var(--gray-500);">Loading product details...</p>
                </div>
            `;
            
            try {
                const product = state.products.find(p => p.productId === productId);
                
                if (product) {
                    const images = product.images && product.images.length > 0 ? product.images : [CONFIG.DEFAULT_IMAGE];
                    
                    let galleryHTML = '';
                    let thumbnailsHTML = '';
                    let dotsHTML = '';
                    
                    images.forEach((img, index) => {
                        galleryHTML += `
                            <div class="gallery-slide ${index === 0 ? 'active' : ''}">
                                <img src="${img}" alt="${product.name} - Image ${index + 1}" 
                                     onerror="this.src='${CONFIG.DEFAULT_IMAGE}'">
                            </div>
                        `;
                        
                        thumbnailsHTML += `
                            <div class="thumbnail ${index === 0 ? 'active' : ''}" onclick="changeGalleryImage(${index})">
                                <img src="${img}" alt="Thumbnail ${index + 1}"
                                     onerror="this.src='${CONFIG.DEFAULT_IMAGE}'">
                            </div>
                        `;
                        
                        dotsHTML += `
                            <div class="gallery-dot ${index === 0 ? 'active' : ''}" onclick="changeGalleryImage(${index})"></div>
                        `;
                    });
                    
                    elements.productModalBody.innerHTML = `
                        <div style="display: grid; gap: 1.5rem;">
                            <div class="product-gallery">
                                <div class="gallery-main" id="galleryMain">
                                    ${galleryHTML}
                                </div>
                                ${images.length > 1 ? `
                                    <div class="gallery-nav gallery-prev" onclick="prevGalleryImage()">‚Äπ</div>
                                    <div class="gallery-nav gallery-next" onclick="nextGalleryImage()">‚Ä∫</div>
                                    <div class="gallery-dots" id="galleryDots">
                                        ${dotsHTML}
                                    </div>
                                ` : ''}
                            </div>
                            
                            ${images.length > 1 ? `
                                <div class="gallery-thumbnails" id="galleryThumbnails">
                                    ${thumbnailsHTML}
                                </div>
                            ` : ''}
                            
                            <div>
                                <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--black);">
                                    ${product.name}
                                </h3>
                                <div style="font-size: 1.75rem; font-weight: 800; color: var(--maroon); margin-bottom: 1rem;">
                                    KSh ${product.price.toLocaleString()}
                                </div>
                                
                                ${product.description ? `
                                    <div style="margin-bottom: 1rem; padding: 1rem; background: var(--gray-100); border-radius: var(--radius-md);">
                                        <h4 style="font-weight: 600; margin-bottom: 0.5rem; color: var(--black);">Description</h4>
                                        <p style="color: var(--gray-700); line-height: 1.6;">${product.description}</p>
                                    </div>
                                ` : ''}
                                
                                <div style="background: var(--gray-100); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1.5rem;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span style="font-weight: 600; color: var(--black);">Seller:</span>
                                        <span>${product.sellerName} ${product.sellerStatus === 'verified' ? '‚úì' : ''}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span style="font-weight: 600; color: var(--black);">Category:</span>
                                        <span>${product.category || 'General'}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="font-weight: 600; color: var(--black);">Availability:</span>
                                        <span>${product.stock > 0 ? `${product.stock} in stock` : 'Out of stock'}</span>
                                    </div>
                                </div>
                                
                                <div style="display: grid; gap: 0.75rem;">
                                    <button class="btn btn-primary" onclick="contactSeller('${product.sellerId}', '${product.name}', ${product.price})">
                                        üí¨ Contact Seller on WhatsApp
                                    </button>
                                    <button class="btn btn-secondary" onclick="saveForLater('${product.productId}')">
                                        ‚≠ê Save for Later
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Initialize gallery
                    window.currentGalleryImages = images;
                    window.currentGalleryIndex = 0;
                } else {
                    elements.productModalBody.innerHTML = `
                        <div style="text-align: center; padding: 2rem;">
                            <p style="color: var(--gray-500);">Product not found</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading product:', error);
                elements.productModalBody.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <p style="color: var(--gray-500);">Error loading product details</p>
                    </div>
                `;
            }
        }
        
        // Gallery functions
        window.changeGalleryImage = function(index) {
            const slides = document.querySelectorAll('.gallery-slide');
            const thumbnails = document.querySelectorAll('.thumbnail');
            const dots = document.querySelectorAll('.gallery-dot');
            
            slides.forEach(slide => slide.classList.remove('active'));
            thumbnails.forEach(thumb => thumb.classList.remove('active'));
            dots.forEach(dot => dot.classList.remove('active'));
            
            slides[index].classList.add('active');
            thumbnails[index].classList.add('active');
            dots[index].classList.add('active');
            
            window.currentGalleryIndex = index;
        };
        
        window.prevGalleryImage = function() {
            const newIndex = (window.currentGalleryIndex - 1 + window.currentGalleryImages.length) % window.currentGalleryImages.length;
            window.changeGalleryImage(newIndex);
        };
        
        window.nextGalleryImage = function() {
            const newIndex = (window.currentGalleryIndex + 1) % window.currentGalleryImages.length;
            window.changeGalleryImage(newIndex);
        };
        
        // ==================== FILTERING ====================
        function filterProducts() {
            let filtered = [...state.products];
            
            // Apply category filter
            if (state.selectedCategory !== 'all') {
                filtered = filtered.filter(product => {
                    const productCategory = product.category?.toLowerCase().replace(/[^a-z0-9]/g, '-');
                    return productCategory === state.selectedCategory;
                });
            }
            
            // Apply search filter
            if (state.searchQuery) {
                filtered = filtered.filter(product =>
                    product.name.toLowerCase().includes(state.searchQuery) ||
                    (product.description && product.description.toLowerCase().includes(state.searchQuery)) ||
                    (product.category && product.category.toLowerCase().includes(state.searchQuery)) ||
                    (product.tags && product.tags.toLowerCase().includes(state.searchQuery))
                );
            }
            
            state.filteredProducts = filtered;
            state.currentPage = 1;
            renderProducts();
            updateCategoryCounts();
        }
        
        function clearFilters() {
            state.selectedCategory = 'all';
            state.searchQuery = '';
            elements.searchInput.value = '';
            filterProducts();
        }
        
        function updateCategoryCounts() {
            if (!state.categories.length) return;
            
            // Count products per category
            const categoryCounts = {};
            state.products.forEach(product => {
                if (product.category) {
                    const categoryKey = product.category.toLowerCase().replace(/[^a-z0-9]/g, '-');
                    categoryCounts[categoryKey] = (categoryCounts[categoryKey] || 0) + 1;
                }
            });
            
            // Update category cards
            const categoryCards = elements.categoryGrid.querySelectorAll('.category-card');
            categoryCards.forEach(card => {
                const categoryName = card.querySelector('.category-name').textContent;
                if (categoryName === 'All') {
                    const countElement = card.querySelector('.category-count');
                    if (countElement) {
                        countElement.textContent = state.products.length;
                    }
                } else {
                    const categoryKey = categoryName.toLowerCase().replace(/[^a-z0-9]/g, '-');
                    const countElement = card.querySelector('.category-count');
                    if (countElement) {
                        countElement.textContent = categoryCounts[categoryKey] || 0;
                    }
                }
            });
        }
        
        function updateProductCount() {
            elements.totalProducts.textContent = state.products.length;
        }
        
        function updateStatsDisplay(stats) {
            if (stats.totalProducts) {
                elements.totalProducts.textContent = stats.totalProducts;
            }
            if (stats.activeSellers) {
                elements.activeSellers.textContent = stats.activeSellers;
            }
            if (stats.totalCustomers) {
                elements.happyCustomers.textContent = stats.totalCustomers.toLocaleString();
            }
            if (stats.cities) {
                elements.citiesCovered.textContent = stats.cities;
            }
        }
        
        // ==================== PRODUCT INTERACTIONS ====================
        function contactSeller(sellerId, productName = '', productPrice = 0) {
            // In a real implementation, you would fetch seller's WhatsApp from backend
            const phone = '254712345678'; // Placeholder
            const message = productName ? 
                `Hi, I'm interested in your "${productName}" for KSh ${productPrice.toLocaleString()}. Is it available?` :
                'Hi, I found you on SokoInn and would like to inquire about your products.';
            
            const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
            
            showToast('Opening WhatsApp...', 'info');
        }
        
        function saveForLater(productId) {
            const saved = JSON.parse(localStorage.getItem('sokoinn_saved') || '[]');
            if (!saved.includes(productId)) {
                saved.push(productId);
                localStorage.setItem('sokoinn_saved', JSON.stringify(saved));
                showToast('Product saved for later!', 'success');
            } else {
                showToast('Product already saved', 'info');
            }
        }
        
        // ==================== SELLER REGISTRATION ====================
        async function handleSellerRegistration(e) {
            e.preventDefault();
            
            const formData = new FormData(elements.sellerForm);
            const sellerData = {
                businessName: formData.get('businessName'),
                ownerName: formData.get('ownerName'),
                whatsappNumber: formData.get('whatsappNumber'),
                email: formData.get('email'),
                location: formData.get('location'),
                products: formData.get('products')
            };
            
            // Validate WhatsApp number
            if (!sellerData.whatsappNumber.match(/^254[17]\d{8}$/)) {
                showToast('Please enter a valid Kenyan WhatsApp number (e.g., 254712345678)', 'error');
                return;
            }
            
            // Disable submit button
            elements.submitSellerBtn.disabled = true;
            elements.submitSellerBtn.innerHTML = '<div class="loading"></div> Submitting...';
            
            try {
                const response = await fetch(CONFIG.BACKEND_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'registerSeller',
                        ...sellerData
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast('Application submitted! We\'ll contact you via WhatsApp within 24 hours.', 'success');
                    elements.sellerForm.reset();
                    elements.sellerModal.classList.remove('active');
                    document.body.style.overflow = '';
                } else {
                    throw new Error(data.message || 'Registration failed');
                }
            } catch (error) {
                console.error('Error registering seller:', error);
                showToast(error.message || 'Failed to submit application. Please try again.', 'error');
            } finally {
                elements.submitSellerBtn.disabled = false;
                elements.submitSellerBtn.textContent = 'Submit Application';
            }
        }
        
        // ==================== LAZY LOADING ====================
        function setupLazyLoading() {
            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            if (!img.classList.contains('loaded')) {
                                img.classList.add('loaded');
                            }
                            imageObserver.unobserve(img);
                        }
                    });
                });
                
                // Observe images as they're added
                const observer = new MutationObserver(() => {
                    document.querySelectorAll('.lazy-image:not(.loaded)').forEach(img => {
                        imageObserver.observe(img);
                    });
                });
                
                observer.observe(document.body, {
                    childList: true,
                    subtree: true
                });
            }
        }
        
        function lazyLoadImages() {
            const images = document.querySelectorAll('.lazy-image:not(.loaded)');
            images.forEach(img => {
                if (img.complete && img.naturalHeight !== 0) {
                    img.classList.add('loaded');
                }
            });
        }
        
        // ==================== UTILITY FUNCTIONS ====================
        function showToast(message, type = 'info') {
            elements.toast.textContent = message;
            elements.toast.className = `toast ${type}`;
            elements.toast.classList.add('show');
            
            setTimeout(() => {
                elements.toast.classList.remove('show');
            }, 3000);
        }
        
        // ==================== EVENT LISTENERS ====================
        elements.loadMore.addEventListener('click', () => {
            state.currentPage++;
            renderProducts();
        });
        
        elements.viewAll.addEventListener('click', (e) => {
            e.preventDefault();
            clearFilters();
            window.scrollTo({
                top: document.getElementById('products').offsetTop - 80,
                behavior: 'smooth'
            });
        });
        
        // ==================== GLOBAL FUNCTIONS ====================
        window.viewProduct = viewProduct;
        window.contactSeller = contactSeller;
        window.showSellerModal = showSellerModal;
        window.saveForLater = saveForLater;
        window.clearFilters = clearFilters;
        
        // Modal helper functions
        window.showContactModal = function() {
            showToast('Contact feature coming soon!', 'info');
        };
        
        window.showSellerGuide = function() {
            showToast('Seller guide coming soon!', 'info');
        };
        
        window.showTerms = function() {
            showToast('Terms & Conditions coming soon!', 'info');
        };
        
        window.showSupport = function() {
            showToast('Support center coming soon!', 'info');
        };
    </script>
    
    <!-- Service Worker Script -->
    <script>
        // Register service worker
        if ('serviceWorker' in navigator) {
            const swScript = `
                // Service Worker for SokoInn Marketplace
                const CACHE_NAME = 'sokoinn-v1.0';
                const urlsToCache = [
                    '/',
                    '/index.html',
                    '/manifest.json',
                    '/icons/icon-72.png',
                    '/icons/icon-96.png',
                    '/icons/icon-128.png',
                    '/icons/icon-144.png',
                    '/icons/icon-152.png',
                    '/icons/icon-192.png',
                    '/icons/icon-384.png',
                    '/icons/icon-512.png'
                ];
                
                // Install event
                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => cache.addAll(urlsToCache))
                    );
                });
                
                // Activate event
                self.addEventListener('activate', event => {
                    event.waitUntil(
                        caches.keys().then(cacheNames => {
                            return Promise.all(
                                cacheNames.map(cacheName => {
                                    if (cacheName !== CACHE_NAME) {
                                        return caches.delete(cacheName);
                                    }
                                })
                            );
                        })
                    );
                });
                
                // Fetch event
                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => {
                                // Return cached version or fetch new
                                return response || fetch(event.request);
                            })
                    );
                });
                
                // Background sync for offline submissions
                self.addEventListener('sync', event => {
                    if (event.tag === 'seller-registration') {
                        event.waitUntil(syncSellerRegistrations());
                    }
                });
                
                async function syncSellerRegistrations() {
                    // Implementation for syncing offline submissions
                    console.log('Syncing seller registrations...');
                }
            `;
            
            // Create a Blob URL for the service worker script
            const blob = new Blob([swScript], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then(registration => {
                    console.log('Service Worker registered:', registration);
                })
                .catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
        }
    </script>
</body>
</html>
